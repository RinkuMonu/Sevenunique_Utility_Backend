name: ğŸš€ DEV CI/CD - Git Reset Deploy (Bbbps Backend)

on:
  push:
    branches:
      - dev

jobs:
  deploy:
    runs-on: ubuntu-latest

    steps:
      - name: ğŸ” Deploy via SSH (Git Reset Hard)
        uses: appleboy/ssh-action@master
        with:
          host: ${{ secrets.DEV_SSH_HOST }}
          username: devserve
          key: ${{ secrets.DEV_SSH_KEY }}
          port: ${{ secrets.DEV_SSH_PORT }}
          script: |
            echo "Connected as:"
            whoami
            hostname

            cd /home/devserve/public_html/Bbbps_Backend

            echo "Fetching latest code..."
            git fetch origin

            echo "Resetting server code to origin/dev..."
            git reset --hard origin/dev

            echo "Installing dependencies..."
            npm install --production

            echo "Restarting PM2..."
            pm2 restart Dev_Bbbps_Backend || pm2 start server.js --name Dev_Bbbps_Backend

            pm2 save
